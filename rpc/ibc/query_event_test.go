package ibc_test

import (
	"context"
	"encoding/hex"
	"encoding/json"
	"testing"

	client "github.com/ComposableFi/go-substrate-rpc-client/v4"
	"github.com/ComposableFi/go-substrate-rpc-client/v4/config"
	"github.com/ComposableFi/go-substrate-rpc-client/v4/types"
	"github.com/stretchr/testify/require"
)

func TestQueryIBCEvents(t *testing.T) {
	cl, err := client.NewSubstrateAPI(config.Default().RPCURL)
	require.NoError(t, err)
	events, err := cl.RPC.IBC.QueryIbcEvents(context.Background(), []types.BlockNumberOrHash{{Number: 1}, {Number: 2}})
	require.NoError(t, err)
	require.Equal(t, map[string][]interface{}{}, events)
}

func TestQuerySampleIBCEvents(t *testing.T) {
	var result types.IBCEventsQueryResult
	b, err := hex.DecodeString(sampleIBCEvents)
	require.NoError(t, err)

	err = json.Unmarshal(b, &result)
	require.NoError(t, err)
}

const sampleIBCEvents = "5b7b22437265617465436c69656e74223a7b22686569676874223a7b227265766973696f6e5f6e756d626572223a302c227265766973696f6e5f686569676874223a317d2c22636c69656e745f6964223a2230372d74656e6465726d696e742d30222c22636c69656e745f74797065223a2254656e6465726d696e74222c22636f6e73656e7375735f686569676874223a7b227265766973696f6e5f6e756d626572223a302c227265766973696f6e5f686569676874223a31307d7d7d2c7b2253656e645061636b6574223a7b22686569676874223a7b227265766973696f6e5f6e756d626572223a302c227265766973696f6e5f686569676874223a31307d2c227061636b6574223a7b2273657175656e6365223a302c22736f757263655f706f7274223a227472616e73666572222c22736f757263655f6368616e6e656c223a226368616e6e656c2d30222c2264657374696e6174696f6e5f706f7274223a2264656661756c74506f7274222c2264657374696e6174696f6e5f6368616e6e656c223a226368616e6e656c2d30222c2264617461223a22222c2274696d656f75745f686569676874223a7b227265766973696f6e5f6e756d626572223a302c227265766973696f6e5f686569676874223a307d2c2274696d656f75745f74696d657374616d70223a7b2274696d65223a22313937302d30312d30315430303a30303a31305a227d7d7d7d2c7b22526563656976655061636b6574223a7b22686569676874223a7b227265766973696f6e5f6e756d626572223a31302c227265766973696f6e5f686569676874223a31307d2c227061636b6574223a7b2273657175656e6365223a302c22736f757263655f706f7274223a2264656661756c74506f7274222c22736f757263655f6368616e6e656c223a226368616e6e656c2d30222c2264657374696e6174696f6e5f706f7274223a2264656661756c74506f7274222c2264657374696e6174696f6e5f6368616e6e656c223a226368616e6e656c2d30222c2264617461223a22222c2274696d656f75745f686569676874223a7b227265766973696f6e5f6e756d626572223a302c227265766973696f6e5f686569676874223a307d2c2274696d656f75745f74696d657374616d70223a7b2274696d65223a6e756c6c7d7d7d7d5d"
